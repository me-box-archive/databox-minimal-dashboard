<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>Databox Minimal Dashboard</title>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

		<style>
			body {
				min-height: 2000px;
				padding-top: 70px;
			}
		</style>
	</head>
	<body>
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">Databox Placeholder Dashboard</a>
				</div>
				<div id="navbar" class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li class="active"><a href="#overview" data-toggle="tab">Overview</a></li>
						<li><a href="#running" data-toggle="tab">Running Apps</a></li>
						<li><a href="#all" data-toggle="tab">All Apps</a></li>
						<li><a href="#store" data-toggle="tab">Store</a></li>
					</ul>
				</div><!--/.nav-collapse -->
			</div>
		</nav>

		<div class="tab-content">
			<div class="tab-pane fade in active" id="overview">
				<div class="container">
					<p>Broker Status: <span id="broker-status">Running</span></p>
					<button id="broker-status-toggle-button">Toggle Broker Status</button>
					<p>Some kind of native data overview app</p>
				</div>
			</div>
			<div class="tab-pane fade" id="running">
				<div class="container">
					<p>Click for app UI</p>
					<div class="list-group"></div>
				</div>
			</div>
			<div class="tab-pane fade" id="all">
				<div class="container">
					<ul class="list-group"></ul>
				</div>
			</div>
			<div class="tab-pane fade" id="store">
				<div class="container">
					<h4>Repositories on Private Docker Registry</h4>
					<p>Catalogue source: <a href="https://amar.io:5000/v2/_catalog">https://amar.io:5000/v2/_catalog</a></p>
					<ul class="list-group">
						<img src="spinner.svg" style="float: left;"></img><h4>Loading...</h4>
					</ul>
				</div>
			</div>
		</div>

		<script>
			$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
				switch($(e.target).attr('href')) {
					case '#running':
						$.post('/list-containers', { all: false }, function(data) {
							$('#running .list-group').empty();
							data = JSON.parse(data);
							for (var i = 0, len = data.length; i < len; ++i) {
								var li = $('<button type="button" class="list-group-item"></button>')
								$('<pre></pre>').text(JSON.stringify(data[i], null, 2)).appendTo(li);
								li.appendTo('#running .list-group');
							}
						});
						break;
					case '#all':
						$.post('/list-images', {}, function(data) {
							$('#all .list-group').empty();
							data = JSON.parse(data);
							for (var i = 0, len = data.length; i < len; ++i) {
								var li = $('<li class="list-group-item"></li>')
								$('<pre></pre>').text(JSON.stringify(data[i], null, 2)).appendTo(li);
								li.appendTo('#all .list-group');
							}
						});
						break;
					case '#store':
						$.post('/list-store', {}, function(data) {
							$('#store .list-group').empty();
							data = JSON.parse(data);
							for (var i = 0, len = data.repositories.length; i < len; ++i) {
								sanitizedText = $('<div/>')
								var li = $('<li class="list-group-item"></li>');
								$('<p></p>').text(data.repositories[i]).appendTo(li);
								$('<button>Pull</button>').appendTo(li);
								li.appendTo('#store .list-group');
							}
						});
						break;
					default:
						break;
				}
			});

			$(function() {
				$.post('/list-containers', { all: false }, function(data) {
					$('#running .list-group').empty();
					data = JSON.parse(data);
					for (var i = 0, len = data.length; i < len; ++i) {
						var li = $('<li class="list-group-item"></li>')
						$('<code></code>').text(JSON.stringify(data[i], null, 2)).appendTo(li);
						li.appendTo('#running .list-group');
					}
				});

				function updateStatus() {
					$.post('/get-broker-status', {}, function(status) {
						$('#broker-status').text(status);
					});
				}
				updateStatus();
				setInterval(updateStatus, 2000);

				$('#broker-status-toggle-button').click(function(event) {
					$.post('/toggle-broker-status', {}, function(status) {
						$('#broker-status').text(status);
					});
				});

				$('#hello-world-launch').click(function(event) {
					$.post('/launch-app', { name: 'databox-hello-world', tag: 'latest' }, function(status) {
						console.log(status);
					});
				});
			});
		</script>
	</body>
</html>
